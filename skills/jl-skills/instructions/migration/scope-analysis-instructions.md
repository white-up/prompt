# 范围分析指令 (Scope Analysis Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行系统迁移的**领域边界识别与依赖分析（阶段 1）**。

> [!IMPORTANT]
> **目标**: 理解旧系统，划定重构范围。
> **输出**: `Migration_Context.md`

---

## 步骤 1: 确认范围与目标

**你必须输出以下内容，然后停止**:

### 1.1 收集输入

**输入内容**:
1. **旧系统源码路径**
2. **迁移范围**: 全量/模块
3. **目标架构**: JDK版本, Spring Boot版本, DB类型

### 1.2 扫描目录结构

**扫描内容**: 分析目录结构

### 1.3 输出范围确认

**输出格式**:

````markdown
## 步骤 1: 确认范围与目标

📊 **进度**: [1/3] 范围分析
[███████░░░░░░░░░░░░░] 33%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| | 1.确认范围与目标 | 2.静态分析 |
| | | 3.生成报告 |

---

### 迁移范围

| 项目 | 内容 |
|------|------|
| **旧系统路径** | [路径] |
| **迁移范围** | [全量/模块] |
| **目标架构** | JDK [版本], Spring Boot [版本], [数据库类型] |

### 目录结构分析

```
old-system/
├── src/main/java/
│   ├── controller/
│   ├── service/
│   └── dao/
```

---

📋 **确认检查点**

迁移范围和目标是否准确？

- 回复 **确认** → 进入静态分析
- 回复 **调整范围: [内容]** → 我将调整
- 回复 **调整目标: [内容]** → 我将调整

**请确认：** 迁移范围和目标是否正确？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 2 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤2的内容。

---

## 步骤 2: 静态分析

**你必须输出以下内容，然后停止**:

### 2.1 AST分析

**分析内容**:
1. **识别组件**: Controller, Service, DAO, Entity
2. **生成调用链**: 简易调用链

### 2.2 依赖识别

**识别内容**:
1. **外部依赖**: Redis, MQ, Feign/Dubbo
2. **技术债**: 标记过时 API、复杂逻辑块

### 2.3 输出静态分析

**输出格式**:

````markdown
## 步骤 2: 静态分析

📊 **进度**: [2/3] 范围分析
[█████████████░░░░░░░] 67%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.确认范围与目标 | 2.静态分析 | 3.生成报告 |

---

### 代码结构统计

| 类型 | 数量 | 说明 |
|------|------|------|
| Controller | X | API接口层 |
| Service | X | 业务逻辑层 |
| DAO | X | 数据访问层 |
| Entity | X | 实体类 |

### 外部依赖

| 依赖类型 | 依赖项 | 说明 |
|---------|--------|------|
| 缓存 | Redis | 用于缓存 |
| 消息队列 | RabbitMQ | 用于异步消息 |
| RPC | Feign | 用于服务调用 |

### 技术债

| 问题 | 位置 | 严重程度 |
|------|------|---------|
| 过时API | XxxService.java:15 | ⚠️ 中 |
| 复杂逻辑 | YyyService.java:100 | 🔴 高 |

---

📋 **确认检查点**

静态分析是否完整？

- 回复 **确认** → 进入生成报告
- 回复 **补充依赖: [依赖项]** → 我将添加
- 回复 **调整: [内容]** → 我将调整

**请确认：** 静态分析是否完整？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤3的内容。

---

## 步骤 3: 生成报告

**你必须输出以下内容，然后停止**:

### 3.1 整合报告

**整合内容**:
1. **使用模板**: `jl-skills/templates/JL-Template-Migration-Context.md`
2. **内容**: 业务范围定义、外部依赖清单、数据库 Schema 差异预览

### 3.2 输出报告预览

**输出格式**:

````markdown
## 步骤 3: 生成报告

📊 **进度**: [3/3] 范围分析
[████████████████████] 100%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.确认范围与目标 | 3.生成报告 | |
| 2.静态分析 | | |

---

### 报告预览

**报告文件**: `jl-skills/generated/migration/{date}/Migration_Context.md`

**报告内容**:
- ✅ 业务范围定义
- ✅ 外部依赖清单
- ✅ 数据库 Schema 差异预览
- ✅ 代码结构统计
- ✅ 技术债清单

---

📋 **确认检查点**

报告内容是否完整？

- 回复 **确认** → 写入报告文件
- 回复 **调整报告: [内容]** → 我将调整

**请确认：** 是否写入报告文件？
````

**🛑 STOP HERE - 必须等待用户确认后才能继续**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤。

---

## 阶段 1 完成: 写入报告

**触发条件**: 用户确认步骤3后

**输出格式**:

````markdown
---

## ✅ 阶段 1 完成

| ✅ 已完成 | 🔄 即将开始 |
|:----------|:------------|
| 阶段1: 范围分析 | 阶段2: 黄金测试 |

**范围分析已完成**:
- ✅ 迁移范围已确认
- ✅ 静态分析已完成
- ✅ 报告已生成

### 📄 已写入文件

**文件**: `jl-skills/generated/migration/{date}/Migration_Context.md`

---

🛑 **下一步**

是否进入阶段2: 黄金测试生成？

请回复：
- **继续** → 进入阶段2: 黄金测试
- **结束** → 完成当前流程
````

**🛑 STOP HERE - 等待用户确认进入下一阶段**
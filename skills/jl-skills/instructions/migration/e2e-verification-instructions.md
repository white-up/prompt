# E2E 验证指令 (E2E Verification Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行**端到端集成验证（阶段 5）**。

> [!IMPORTANT]
> **目标**: 验证新系统与黄金标准的一致性。

---

## 步骤 1: 运行黄金测试集

**你必须输出以下内容，然后停止**:

### 1.1 执行测试

**执行内容**: 针对新系统（New System）运行阶段 2 生成的黄金测试集

### 1.2 对比结果

**对比内容**: 比较新旧系统的响应，允许微小的格式差异（如时间戳格式），但不允许业务数据差异

### 1.3 输出测试结果

**输出格式**:

````markdown
## 步骤 1: 运行黄金测试集

📊 **进度**: [1/3] E2E验证
[███████░░░░░░░░░░░░░] 33%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| | 1.运行黄金测试集 | 2.数据一致性校验 |
| | | 3.最终报告 |

---

### 测试结果

| 测试用例 | 旧系统结果 | 新系统结果 | 一致性 |
|---------|-----------|-----------|--------|
| TC-001: 创建订单 | 200 OK | 200 OK | ✅ 一致 |
| TC-002: 支付订单 | 200 OK | 200 OK | ✅ 一致 |
| TC-003: 取消订单 | 200 OK | 200 OK | ✅ 一致 |

**测试通过率**: 100%

---

📋 **确认检查点**

黄金测试集运行结果是否通过？

- 回复 **确认** → 进入数据一致性校验
- 回复 **测试失败: [测试用例]** → 我将协助排查
- 回复 **调整: [内容]** → 我将调整

**请确认：** 黄金测试集是否通过？
````

**🛑 STOP HERE - 必须等待用户确认后才能继续**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤。

---

## 步骤 2: 数据一致性校验

### 2.1 执行校验脚本

**执行内容**: 运行阶段 3 的数据校验脚本

### 2.2 验证数据一致性

**验证内容**: 确保迁移后的数据总量和关键指标一致

### 2.3 输出数据校验结果

**输出格式**:

````markdown
## 步骤 2: 数据一致性校验

📊 **进度**: [2/3] E2E验证
[█████████████░░░░░░░] 67%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.运行黄金测试集 | 2.数据一致性校验 | 3.最终报告 |

---

### 数据校验结果

| 校验项 | 旧系统 | 新系统 | 一致性 |
|--------|--------|--------|--------|
| 订单总数 | 1000 | 1000 | ✅ 一致 |
| 订单总金额 | 100000.00 | 100000.00 | ✅ 一致 |
| 用户总数 | 500 | 500 | ✅ 一致 |

**数据一致性**: 100%

---

📋 **确认检查点**

数据一致性校验是否通过？

- 回复 **确认** → 进入最终报告
- 回复 **数据不一致: [校验项]** → 我将协助排查
- 回复 **调整: [内容]** → 我将调整

**请确认：** 数据一致性校验是否通过？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤3的内容。

---

## 步骤 3: 最终报告

**你必须输出以下内容，然后停止**:

### 3.1 汇总结果

**汇总内容**:
1. **测试通过率**
2. **覆盖率报告**
3. **迁移总结**

### 3.2 生成报告

**生成内容**: 生成 `Migration_Final_Report.md`

### 3.3 输出最终报告

**输出格式**:

````markdown
## 步骤 3: 最终报告

📊 **进度**: [3/3] E2E验证
[████████████████████] 100%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.运行黄金测试集 | 3.最终报告 | |
| 2.数据一致性校验 | | |

---

### 最终报告预览

**报告文件**: `jl-skills/generated/migration/{date}/Migration_Final_Report.md`

**报告内容**:
- ✅ 测试通过率: 100%
- ✅ 覆盖率报告: 85%
- ✅ 迁移总结: 所有阶段已完成

---

📋 **确认检查点**

最终报告是否完整？

- 回复 **确认** → 写入报告文件
- 回复 **调整报告: [内容]** → 我将调整

**请确认：** 是否写入最终报告？
````

**🛑 STOP HERE - 必须等待用户确认后才能继续**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤。

---

## 阶段 5 完成: 迁移完成

**触发条件**: 用户确认步骤3后

**输出格式**:

````markdown
---

## ✅ 阶段 5 完成

| ✅ 已完成 |
|:----------|
| 阶段1: 范围分析 |
| 阶段2: 黄金测试 |
| 阶段3: 数据迁移 |
| 阶段4: 分层重构 |
| 阶段5: E2E验证 |

**E2E验证已完成**:
- ✅ 黄金测试集已通过
- ✅ 数据一致性已校验
- ✅ 最终报告已生成

### 📄 已写入文件

**文件**: `jl-skills/generated/migration/{date}/Migration_Final_Report.md`

---

## ✅ 系统迁移完成

**迁移总结**:
- ✅ 所有阶段已完成
- ✅ 新系统与旧系统行为一致
- ✅ 数据迁移成功

**后续建议**: 进行生产环境灰度发布
````

**🛑 STOP HERE - 迁移完成**
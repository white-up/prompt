# 黄金测试生成指令 (Golden Test Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 建立**黄金标准测试集（阶段 2）**。

> [!IMPORTANT]
> **目标**: 确保重构前后的业务行为一致性。
> **原则**: 针对旧代码编写特征测试 (Characterization Test)。
> **测试方法命名规范**: 参考 `jl-skills/specs/Java编码规范.md` - 方法名全英文下划线命名，中文意图使用 `@DisplayName("")` 注解。

---

## 步骤 1: 识别关键路径

**你必须输出以下内容，然后停止**:

### 1.1 分析核心业务链路

**分析内容**:
1. **基于上一阶段**: 使用 `Migration_Context.md`
2. **找出核心链路**: 如下单、支付

### 1.2 输出关键路径

**输出格式**:

````markdown
## 步骤 1: 识别关键路径

📊 **进度**: [1/3] 黄金测试生成
[███████░░░░░░░░░░░░░] 33%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| | 1.识别关键路径 | 2.生成测试用例 |
| | | 3.保存工件 |

---

### P0 级业务场景

| 场景ID | 场景名称 | 说明 | 优先级 |
|--------|---------|------|--------|
| TC-001 | 创建订单 | 用户下单流程 | P0 |
| TC-002 | 支付订单 | 订单支付流程 | P0 |
| TC-003 | 取消订单 | 订单取消流程 | P0 |

---

📋 **确认检查点**

关键路径识别是否完整？

- 回复 **确认** → 进入生成测试用例
- 回复 **补充场景: [场景名称]** → 我将添加
- 回复 **调整: [内容]** → 我将调整

**请确认：** 关键路径是否完整？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 2 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤2的内容。

---

## 步骤 2: 生成测试用例

**你必须输出以下内容，然后停止**: (JUnit 5)

### 2.1 定义契约

**定义内容**:
1. **输入**: Request
2. **期望输出**: Response

### 2.2 编写测试

**编写内容**:
1. **为旧系统编写**: Controller 的 JUnit 5 集成测试
2. **标记**: 使用 `@Disabled` 或特定 Tag 标记，表明这是针对旧系统的
3. **测试方法命名规范（强制）**:
    - **方法名**: 全英文，下划线命名，格式：`test_{methodName}_{condition}_{expectedResult}`
    - **中文意图**: 使用 `@DisplayName("中文描述")` 注解
    - **TDD 阶段标识（强制）**: 黄金测试针对旧系统编写，应该在旧系统上通过（🟢 绿灯），所以使用 `@DisplayName("🟢 正常流程：...")`
    - **示例**:
        - `test_createOrder_validInput_shouldReturnSuccess()` + `@DisplayName("🟢 正常流程：有效输入应返回成功")`
        - `test_createOrder_invalidInput_shouldReturnError()` + `@DisplayName("🟢 异常流程：无效输入应返回错误")`

### 2.3 运行测试

**运行要求**: 确保测试在旧系统上**通过**（Green），这些测试将作为新系统的验收标准

### 2.4 输出测试用例

**输出格式**:

````markdown
## 步骤 2: 生成测试用例

📊 **进度**: [2/3] 黄金测试生成
[█████████████░░░░░░░] 67%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.识别关键路径 | 2.生成测试用例 | 3.保存工件 |

---

### 测试用例预览

**测试文件**: `tests/golden/OrderGoldenTest.java`

**测试场景**:
- TC-001: 创建订单测试
- TC-002: 支付订单测试
- TC-003: 取消订单测试

**测试说明**:
- ✅ 这些测试针对旧系统编写
- ✅ 使用 `@Disabled` 标记，表明这是黄金标准测试
- ✅ 测试在旧系统上通过后，将作为新系统的验收标准

---

📋 **确认检查点**

测试用例生成是否完整？

- 回复 **确认** → 进入保存工件
- 回复 **调整测试: [内容]** → 我将调整

**请确认：** 测试用例是否完整？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤3的内容。

---

## 步骤 3: 保存工件

**你必须输出以下内容，然后停止**:

### 3.1 保存测试代码

**保存内容**:
1. **测试代码**: 保存到 `tests/golden/` 目录
2. **覆盖率报告**: 生成测试覆盖率报告

### 3.2 输出保存结果

**输出格式**:

````markdown
## 步骤 3: 保存工件

📊 **进度**: [3/3] 黄金测试生成
[████████████████████] 100%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.识别关键路径 | 3.保存工件 | |
| 2.生成测试用例 | | |

---

### ✅ 测试代码已保存

**保存位置**: `tests/golden/`

**测试文件**:
- `OrderGoldenTest.java`
- `PaymentGoldenTest.java`

**覆盖率报告**: `tests/golden/coverage-report.html`

---

📋 **确认检查点**

工件保存是否完成？

- 回复 **确认** → 进入下一阶段
- 回复 **调整: [内容]** → 我将调整

**请确认：** 工件保存是否完成？
````

**🛑 STOP HERE - 必须等待用户确认后才能继续**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤。

---

## 阶段 2 完成: 准备进入数据迁移

**触发条件**: 用户确认步骤3后

**输出格式**:

````markdown
---

## ✅ 阶段 2 完成

| ✅ 已完成 | 🔄 即将开始 |
|:----------|:------------|
| 阶段1: 范围分析 | 阶段3: 数据迁移 |
| 阶段2: 黄金测试 | |

**黄金测试生成已完成**:
- ✅ 关键路径已识别
- ✅ 测试用例已生成
- ✅ 测试代码已保存

---

🛑 **下一步**

是否进入阶段3: 数据迁移？

请回复：
- **继续** → 进入阶段3: 数据迁移
- **结束** → 完成当前流程
````

**🛑 STOP HERE - 等待用户确认进入下一阶段**
# 上下文分析指令 (Context Analysis Instructions)

此文档指导 Agent 执行场景测试生成的**上下文分析（阶段 1）**。

> [!IMPORTANT]
> **目标**: 理解代码逻辑和业务背景，为后续场景识别打下基础。
> **原则**: 准确识别拓扑、状态机和关键变量。

## 步骤 1: 资源加载与范围确认

1.  **加载**:
    - 当前选中的代码或文档。
    - 现有的 DDD 设计文档 (如果有)。
2.  **评估**:
    - 确定被测模块 (Module Under Test)。
3.  **交互**:
    - 询问用户：“我识别到被测模块为 `[Module Name]`，是否需要重点覆盖某些异常场景？”

## 步骤 2: 拓扑还原 (Topology)

1.  **识别组件**:
    - API 层、领域服务、外部依赖 (Client/Gateway)。
2.  **识别数据**:
    - 涉及的数据库表及读写类型。
3.  **交互**:
    - 输出服务拓扑图 (Text 或 Mermaid)。
    - 确认数据库交互列表。

## 步骤 3: 业务状态机 (State Machine)

1.  **分析状态**:
    - 识别枚举值 (Status Enum)。
    - 识别转换条件 (Transitions)。
2.  **可视化**:
    - 使用 `mermaid stateDiagram-v2` 绘制状态机。
3.  **交互**:
    - 确认状态流转逻辑是否准确。

## 步骤 4: 关键变量 (Key Variables)

1.  **识别主键**:
    - `TraceID`, `OrderID`, `UserID` 等贯穿全链路的 ID。
2.  **敏感数据**:
    - 识别需要脱敏的字段（如手机号、密码）。
3.  **交互**:
    - 列出关键变量表，确认无误。

## 步骤 5: 完成

1.  **保存**:
    - 将分析结果暂存到状态文件。
2.  **下一步**:
    - 提示进入“场景识别”阶段。

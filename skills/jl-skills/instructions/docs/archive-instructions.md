# ADR 归档指令 (Archive Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 将指令执行成果归档为 ADR（Architecture Decision Record）。

> [!IMPORTANT]
> **目标**: 记录每次指令执行的决策、成果和后续行动，便于后续参考和文档收拢。
> **模板**: `jl-skills/templates/JL-Template-ADR.md`

---

## 步骤 1: 收集执行信息

**你必须输出以下内容，然后停止**:

1. **识别指令类型**: 确定是哪个指令（/design, /review, /test, /analyze, /migration, /quick-fix, /knowledge）
2. **收集执行信息**:
   - 执行日期和时间
   - 生成的文档路径（`jl-skills/generated/{skill}/{date}/`）
   - 关键决策点
   - 成功指标和实际结果
   - 质量评估结果
3. **提取成果摘要**:
   - 从生成的报告中提取关键成果
   - 识别需要后续行动的事项

**输出格式**:

````markdown
## 步骤 1: 收集执行信息

📊 **进度**: [1/3] ADR 归档
[███████░░░░░░░░░░░░░] 33%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| | 1.收集信息 | 2.生成ADR |
| | | 3.归档 |

---

### 📋 执行信息汇总

| 项目 | 内容 |
|------|------|
| **指令类型** | {/design | /review | /test | ...} |
| **执行日期** | {YYYY-MM-DD} |
| **执行时间** | {HH:mm:ss} |
| **生成文档** | `jl-skills/generated/{skill}/{date}/{文件}.md` |
| **关键决策** | {决策1, 决策2, ...} |
| **成功指标** | {指标1: 实际值, 指标2: 实际值} |

### 📄 成果摘要

**主要成果**:
- {成果1}
- {成果2}

**质量评估**:
- {维度1}: {评分}
- {维度2}: {评分}

---

📋 **确认检查点**

信息收集是否完整？

- 回复 **确认** → 生成 ADR 文档
- 回复 **补充: [内容]** → 我将补充信息

**请确认：** 信息是否完整？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 2 UNTIL USER CONFIRMS**

---

## 步骤 2: 生成 ADR 文档

**前置条件**: 用户已确认信息收集完成

**你必须输出以下内容，然后停止**:

1. **生成 ADR 编号**: 格式为 `ADR-{YYYYMMDD}-{序号}`（如 `ADR-20240120-001`）
2. **填充 ADR 模板**: 基于 `jl-skills/templates/JL-Template-ADR.md`
3. **写入文件**: `docs/adr/ADR-{编号}.md`

**输出格式**:

````markdown
## 步骤 2: 生成 ADR 文档

📊 **进度**: [2/3] ADR 归档
[███████████████░░░░░] 67%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.收集信息 | 2.生成ADR | 3.归档 |

---

### 📄 ADR 文档预览

**ADR 编号**: `ADR-{YYYYMMDD}-{序号}`

**文档路径**: `docs/adr/ADR-{编号}.md`

**关键内容**:
- ✅ 上下文和决策记录
- ✅ 成功指标和成果汇总
- ✅ 后续行动建议
- ✅ 相关文档链接

---

📋 **确认检查点**

ADR 文档是否正确？

- 回复 **确认** → 写入文件并继续归档
- 回复 **调整: [内容]** → 我将修改

**请确认：** ADR 文档是否正确？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

---

## 步骤 3: 归档到文档体系

**前置条件**: 用户已确认 ADR 文档

**你必须输出以下内容，然后停止**:

1. **写入 ADR 文件**: `docs/adr/ADR-{编号}.md`
2. **更新 ADR 索引**: 如果存在 `docs/adr/README.md`，则更新索引；否则创建索引文件
3. **汇总到文档体系**: 
   - 如果是设计相关，更新 `docs/ARCHITECTURE.md`
   - 如果是功能相关，归档到 `docs/FEATURES/`
   - 如果是测试相关，更新 `docs/QA.md`
   - 如果是集成相关，更新 `docs/INTEGRATION.md`

**输出格式**:

````markdown
## 步骤 3: 归档到文档体系

📊 **进度**: [3/3] ADR 归档
[████████████████████] 100%

| ✅ 已完成 | ✅ 已完成 | ✅ 已完成 |
|:----------|:----------|:----------|
| 1.收集信息 | 2.生成ADR | 3.归档 |

---

### ✅ 归档完成

**已写入文件**:
- ✅ `docs/adr/ADR-{编号}.md`
- ✅ `docs/adr/README.md` (索引已更新)

**已更新文档**:
- ✅ `docs/ARCHITECTURE.md` (如适用)
- ✅ `docs/FEATURES/{module}/` (如适用)
- ✅ `docs/QA.md` (如适用)
- ✅ `docs/INTEGRATION.md` (如适用)

---

## ✅ ADR 归档完成

**归档总结**:
- ✅ ADR 文档已生成
- ✅ 文档体系已更新
- ✅ 索引已维护

**后续建议**: 
- 运行 `/docs` 指令可进一步收拢和汇总文档
- 查看 `docs/adr/README.md` 查看所有 ADR 记录

---

**归档完成！**
````

**🛑 STOP HERE - 归档完成**

# 文档初始化指令 (Init Structure Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行项目文档体系的**初始化**。

> [!IMPORTANT]
> **目标**: 构建符合标准的文档骨架，对于已有系统补全为 v0.0.0 版本。
> **模板**:
> - `jl-skills/templates/JL-Template-README.md`
> - `jl-skills/templates/JL-Template-Integration.md`
> - `jl-skills/templates/JL-Template-Architecture.md`

---

## 步骤 1: 确认元数据和系统状态

**你必须输出以下内容，然后停止**:

1. **推断**: 从项目目录名推断项目名称。
2. **检测系统状态**:
    - 检查是否存在源代码目录
    - 检查是否存在配置文件（如 pom.xml, package.json, requirements.txt）
    - 检查是否存在 API 文档或接口定义
    - 检查是否存在数据库脚本或配置
3. **交互**:
    - 询问用户项目名称和核心目标。
    - 询问技术栈关键词（如 Java, Spring Boot, React）。
    - **如果是已有系统**: 询问是否需要补全为 v0.0.0 版本（分析现有架构、外放功能等）

**输出格式**:

````markdown
## 步骤 1: 确认元数据和系统状态

📊 **进度**: [1/5] 文档初始化
[████░░░░░░░░░░░░░░░░] 20%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| | 1.元数据确认 | 2.目录结构 |
| | | 3.基线文档 |
| | | 4.系统分析 |
| | | 5.完成 |

---

### 📋 系统状态检测

| 检测项 | 状态 | 说明 |
|--------|------|------|
| 源代码目录 | ✅/❌ | {路径} |
| 配置文件 | ✅/❌ | {类型} |
| API 文档 | ✅/❌ | {路径} |
| 数据库脚本 | ✅/❌ | {路径} |

**检测结论**:
- **新项目** → 初始化为 v0.0.1
- **已有系统** → 补全为 v0.0.0（需要分析现有架构和功能）

---

### 📝 项目信息收集

请提供以下信息：

| 项目 | 说明 | 示例 |
|------|------|------|
| **项目名称** | 项目英文名 | `order-service` |
| **项目描述** | 一句话描述 | `订单服务，处理订单全生命周期` |
| **技术栈** | 主要技术 | `Java 17, Spring Boot 3, MySQL` |
| **负责人** | 团队或个人 | `张三 / 订单团队` |
| **系统类型** | 新项目/已有系统 | `新项目` / `已有系统` |

**如果是已有系统，是否需要补全为 v0.0.0？**
- 回复 **是** → 将分析现有架构、外放功能等，补全为 v0.0.0 版本
- 回复 **否** → 仅创建文档骨架

**请提供项目信息：**
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 2 UNTIL USER CONFIRMS**

---

## 步骤 2: 创建目录与文件

**前置条件**: 用户已提供项目信息和系统类型确认

**你必须输出以下内容，然后停止**:

1. **创建目录结构**:
    - `docs/CHANGELOG/` - 变更日志归档目录
    - `docs/FEATURES/` - 功能规格归档目录
2. **生成 README**:
    - 基于模板 `jl-skills/templates/JL-Template-README.md` 生成项目根目录的 `README.md`
    - 填充项目名称、简介、技术栈概览
    - 添加文档导航链接（INTEGRATION、ARCHITECTURE、FEATURES）

**输出格式**:

````markdown
## 步骤 2: 创建目录与文件

📊 **进度**: [2/5] 文档初始化
[████████░░░░░░░░░░░░] 40%

| ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|
| 1.元数据确认 | 2.目录结构 | 3.基线文档 |
| | | 4.系统分析 |
| | | 5.完成 |

---

### 📁 即将创建的目录结构

```
Project Root
├── README.md               # [门户] 项目总览和导航
├── docs/
│   ├── CHANGELOG/          # [演进] 宏观的项目迭代记录、版本发布日志
│   │   └── v0.0.{0|1}-init.md
│   ├── INTEGRATION.md      # [接入] 对外的接入指南
│   ├── ARCHITECTURE.md     # [设计] 全局架构决策
│   └── FEATURES/           # [核心业务域] 需求和自测记录
│       └── .gitkeep
```

---

📋 **确认检查点**

目录结构是否正确？

- 回复 **确认** → 创建目录和 README
- 回复 **调整: [说明]** → 我将调整

**请确认：** 目录结构是否正确？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

---

## 步骤 3: 生成基线文档

**前置条件**: 用户已确认目录结构

**你必须输出以下内容，然后停止**:

1. **README.md**: 生成项目根目录的 `README.md`
    - 基于模板 `jl-skills/templates/JL-Template-README.md`
    - 填充项目名称、项目描述、技术栈概览
    - 添加文档导航链接（INTEGRATION、ARCHITECTURE、FEATURES）
    - 添加变更日志链接（指向 `docs/CHANGELOG/`）
2. **Architecture**: 生成 `docs/ARCHITECTURE.md`
    - 基于模板 `jl-skills/templates/JL-Template-Architecture.md`
    - 如果是新项目：仅填充基本信息，留待后续完善
    - 如果是已有系统：分析现有代码结构，填充架构信息
3. **Integration**: 生成 `docs/INTEGRATION.md`
    - 基于模板 `jl-skills/templates/JL-Template-Integration.md`
    - 如果是新项目：仅填充基本信息
    - 如果是已有系统：分析配置文件，填充集成信息
4. **Changelog**:
    - 新项目：生成 `docs/CHANGELOG/v0.0.1-init.md`，内容如下：
      ```markdown
      # [v0.0.1] 项目初始化
      
      ## 📅 基本信息
      - **发布日期**: {YYYY-MM-DD}
      
      ## 🚀 核心变更
      - 项目脚手架初始化
      - 文档体系建立
      ```
    - 已有系统：生成 `docs/CHANGELOG/v0.0.0-init.md`，内容如下：
      ```markdown
      # [v0.0.0] 文档体系初始化
      
      ## 📅 基本信息
      - **发布日期**: {YYYY-MM-DD}
      
      ## 🚀 核心变更
      - 文档体系建立
      - 补全现有系统架构信息
      - 补全现有系统外放功能信息
      ```

**输出格式**:

````markdown
## 步骤 3: 生成基线文档

📊 **进度**: [3/5] 文档初始化
[████████████░░░░░░░░] 60%

| ✅ 已完成 | ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|:----------|
| 1.元数据确认 | 2.目录结构 | 3.基线文档 | 4.系统分析 |
| | | | 5.完成 |

---

### 📄 基线文档预览

**README.md**:
- ✅ 项目概览（项目信息、项目目标、技术栈概览）
- ✅ 关键链接
- ✅ 文档导航（INTEGRATION、ARCHITECTURE、FEATURES）
- ✅ 变更日志链接

**ARCHITECTURE.md**:
- ✅ 项目基本信息
- {如果是已有系统: ✅ 现有架构分析}
- {如果是新项目: ⏳ 待后续完善}

**INTEGRATION.md**:
- ✅ 环境要求
- {如果是已有系统: ✅ 现有集成配置}
- {如果是新项目: ⏳ 待后续完善}

**CHANGELOG**:
- ✅ `docs/CHANGELOG/v0.0.{0|1}-init.md`

---

📋 **确认检查点**

基线文档是否正确？

- 回复 **确认** → 写入文件并继续
- 回复 **调整: [内容]** → 我将修改

**请确认：** 基线文档是否正确？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 4 UNTIL USER CONFIRMS**

---

## 步骤 4: 系统分析（仅已有系统，v0.0.0）

**前置条件**:
- 用户已确认基线文档
- 系统类型为"已有系统"且用户选择补全为 v0.0.0

**⚠️ 如果系统类型为"新项目"，跳过此步骤，直接进入步骤 5**

**你必须输出以下内容，然后停止**:

1. **分析现有架构**:
    - 扫描源代码目录结构
    - 识别技术栈和框架
    - 分析模块划分
    - 识别核心领域模型
2. **分析外放功能**:
    - 扫描 API 接口（Controller、Router 等）
    - 识别对外服务接口
    - 分析功能模块
3. **更新文档**:
    - 更新 `docs/ARCHITECTURE.md`，填充架构信息
    - 更新 `docs/INTEGRATION.md`，填充集成信息
    - 创建 `docs/FEATURES/` 下的功能模块文档（如适用）

**输出格式**:

````markdown
## 步骤 4: 系统分析（v0.0.0 补全）

📊 **进度**: [4/5] 文档初始化
[████████████████░░░░] 80%

| ✅ 已完成 | ✅ 已完成 | ✅ 已完成 | 🔄 进行中 | ⏳ 待完成 |
|:----------|:----------|:----------|:----------|:----------|
| 1.元数据确认 | 2.目录结构 | 3.基线文档 | 4.系统分析 | 5.完成 |

---

### 🔍 系统分析结果

**架构分析**:
- ✅ 技术栈: {Java 17, Spring Boot 3, ...}
- ✅ 模块划分: {模块1, 模块2, ...}
- ✅ 核心领域: {领域1, 领域2, ...}

**功能分析**:
- ✅ 对外接口: {接口1, 接口2, ...}
- ✅ 功能模块: {模块1, 模块2, ...}

**文档更新**:
- ✅ `docs/ARCHITECTURE.md` 已更新
- ✅ `docs/INTEGRATION.md` 已更新
- {如果适用: ✅ `docs/FEATURES/{module}/` 已创建}

---

📋 **确认检查点**

系统分析是否完整？

- 回复 **确认** → 完成初始化
- 回复 **补充: [内容]** → 我将补充

**请确认：** 系统分析是否完整？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 5 UNTIL USER CONFIRMS**

---

## 步骤 5: 完成初始化并检查未归档文档

**前置条件**:
- 用户已确认基线文档（新项目）
- 或用户已确认系统分析（已有系统）

**你必须输出以下内容，然后停止**:

1. **保存**: 写入所有文件
2. **检查未归档文档**: 扫描 `jl-skills/generated/` 目录，检查是否有未归档的文档
3. **反馈**: 告知用户文档体系已就绪，并提示是否有未归档文档需要集成

**输出格式**:

````markdown
## 步骤 5: 完成初始化

📊 **进度**: [5/5] 文档初始化
[████████████████████] 100%

| ✅ 已完成 | ✅ 已完成 | ✅ 已完成 | ✅ 已完成 | ✅ 已完成 |
|:----------|:----------|:----------|:----------|:----------|
| 1.元数据确认 | 2.目录结构 | 3.基线文档 | 4.系统分析 | 5.完成 |

---

## ✅ 文档体系初始化完成

### 📁 已创建文件

| 文件 | 状态 |
|------|------|
| `README.md` | ✅ 已创建 |
| `docs/ARCHITECTURE.md` | ✅ 已创建 |
| `docs/INTEGRATION.md` | ✅ 已创建 |
| `docs/CHANGELOG/v0.0.{0|1}-init.md` | ✅ 已创建 |
| `docs/FEATURES/` | ✅ 已创建 |

### 📋 未归档文档检查

**扫描结果**:

{实际扫描 `jl-skills/generated/` 目录，列出所有最近生成的文档}

{如果有未归档文档，显示如下表格；如果没有，显示"✅ 未发现未归档文档"}

| 指令类型 | 文档路径 | 生成时间 | 状态 |
|----------|---------|----------|------|
| {/design} | `jl-skills/generated/design/{date}/Requirements_Design.md` | {时间} | 📄 待集成 |
| {/test} | `jl-skills/generated/test/{date}/Scenario_Test_Case.md` | {时间} | 📄 待集成 |
| {/test} | `jl-skills/generated/test/{date}/scripts/e2e_test.py` | {时间} | 📄 待集成 |

**检测到 {X} 个未归档文档**

⚠️ **重要**: 
- 必须实际扫描 `jl-skills/generated/` 目录
- 如果检测到未归档文档，必须显示详细列表（包括 Python 测试脚本）
- 如果未检测到未归档文档，明确显示"✅ 未发现未归档文档"

---

📋 **确认检查点**

文档体系已初始化完成！

**是否现在集成未归档文档？**

- 回复 **是** → 进入集成流程（生成 Changelog、归档 FEATURES、更新文档）
- 回复 **否** → 完成初始化，稍后运行 `/docs` 进行集成

**请确认：** 是否现在集成未归档文档？
````

**🛑 STOP HERE - 等待用户确认是否集成**

---

## 步骤 6: 集成未归档文档（可选）

**前置条件**:
- 用户已确认初始化完成
- 用户选择"是"进行集成

**⚠️ 如果用户选择"否"，跳过此步骤，初始化完成**

**⚠️ 执行规则（强制）**:
1. **加载更新指令**: `jl-skills/instructions/docs/update-docs-instructions.md`
2. **按顺序执行更新指令的所有步骤**:
    - 步骤 1: 扫描与收集（询问版本号和变更信息）
    - 步骤 2: 更新 CHANGELOG（生成 `docs/CHANGELOG/{version}-{summary}.md`）
    - 步骤 3: 归档 Feature 文档（归档到 `docs/FEATURES/{module}/`，包含 Python 测试脚本）
    - 步骤 4: 更新 README 索引
    - 步骤 5: 完成
3. **每个步骤必须等待用户确认后才能继续**
4. **禁止一次性输出多个步骤的内容**

**归档规范**:
- `Requirements_Design_*.md` → `docs/FEATURES/{module}/SPEC.md`
- `DDD_Design_*.md` → `docs/FEATURES/{module}/DESIGN.md`
- `Scenario_Test_Case_*.md` → `docs/FEATURES/{module}/QA.md`
- `e2e_test.py` → `docs/FEATURES/{module}/CaseTest{spec}{time}.py`

**🛑 STOP HERE - 集成完成**

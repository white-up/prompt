# 安全审查指令 (Security Review Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行代码审查的**步骤 3: 安全审查**。

> [!IMPORTANT]
> **目标**: 检查代码是否存在安全漏洞，符合 OWASP Top 10 安全规范。

---

## 步骤 3.1: OWASP Top 10 检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **SQL 注入防护** - 检查是否使用参数化查询（MyBatis `#` vs `$`）
2. ✅ **XSS 防护** - 检查是否对用户输入进行转义
3. ✅ **CSRF 防护** - 检查是否实现 CSRF 防护
4. ✅ **认证授权正确** - 检查认证授权逻辑是否正确
5. ✅ **敏感数据加密** - 检查敏感数据是否加密存储

**输出格式**: 同代码合规性审查，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 3.2 UNTIL USER CONFIRMS**

---

## 步骤 3.2: 输入验证检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **所有外部输入验证** - 检查是否对所有外部输入进行验证
2. ✅ **参数边界检查** - 检查是否对参数进行边界检查
3. ✅ **类型转换安全** - 检查类型转换是否安全
4. ✅ **文件上传安全** - 检查文件上传是否安全（文件类型、大小限制等）

**输出格式**: 同步骤 3.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 3.3 UNTIL USER CONFIRMS**

---

## 步骤 3.3: 敏感数据处理检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **密码正确加密存储** - 检查密码是否使用安全的加密算法存储
2. ✅ **敏感数据脱敏日志** - 检查日志中敏感数据是否脱敏
3. ✅ **传输层加密** - 检查敏感数据传输是否使用 HTTPS
4. ✅ **密钥安全管理** - 检查密钥是否安全管理（不在代码中硬编码）

**输出格式**: 同步骤 3.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 3.4 UNTIL USER CONFIRMS**

---

## 步骤 3.4: 会话管理检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **会话超时设置** - 检查会话是否设置了合理的超时时间
2. ✅ **会话固定防护** - 检查是否实现会话固定防护
3. ✅ **安全的 Cookie 配置** - 检查 Cookie 配置是否安全（HttpOnly、Secure、SameSite）

**输出格式**: 同步骤 3.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 3.5 UNTIL USER CONFIRMS**

---

## 步骤 3.5: 安全审查总结

**你必须输出以下内容，然后停止**:

**输出格式**: 同代码合规性审查总结，更新为安全审查的总结

**🛑 STOP HERE - DO NOT OUTPUT STEP 4 UNTIL USER CONFIRMS**

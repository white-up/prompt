# 架构设计审查指令 (Architecture Review Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行代码审查的**步骤 2: 架构设计审查**。

> [!IMPORTANT]
> **目标**: 检查代码是否符合 DDD 架构设计规范。
> **参考**: `jl-skills/specs/架构设计规范.md`（如果存在）

---

## 步骤 2.1: 封装性检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **字段使用适当的访问修饰符** - 检查字段访问修饰符是否合理（private/protected/public）
2. ✅ **不暴露内部实现细节** - 检查是否暴露了不应该暴露的内部实现
3. ✅ **使用防御性拷贝** - 检查可变对象是否使用防御性拷贝
4. ✅ **集合字段返回不可变视图** - 检查集合字段是否返回不可变视图

**输出格式**: 同代码合规性审查，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 2.2 UNTIL USER CONFIRMS**

---

## 步骤 2.2: 聚合边界检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **聚合根清晰定义** - 检查聚合根是否清晰定义
2. ✅ **聚合内实体通过聚合根访问** - 检查聚合内实体是否通过聚合根访问
3. ✅ **跨聚合引用使用 ID** - 检查跨聚合引用是否使用 ID 而非直接引用
4. ✅ **聚合边界事务一致** - 检查聚合边界内的事务一致性

**输出格式**: 同步骤 2.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 2.3 UNTIL USER CONFIRMS**

---

## 步骤 2.3: 领域逻辑检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **业务逻辑在领域层** - 检查业务逻辑是否在领域层而非应用层
2. ✅ **避免贫血模型** - 检查领域模型是否包含行为而非仅有数据
3. ✅ **领域事件正确使用** - 检查领域事件是否正确使用
4. ✅ **领域服务职责清晰** - 检查领域服务职责是否单一清晰

**输出格式**: 同步骤 2.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 2.4 UNTIL USER CONFIRMS**

---

## 步骤 2.4: 值对象使用检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **值对象不可变** - 检查值对象是否不可变
2. ✅ **正确实现 equals/hashCode** - 检查值对象是否正确实现 equals/hashCode
3. ✅ **值对象封装业务概念** - 检查值对象是否封装了业务概念
4. ✅ **避免基本类型偏执** - 检查是否过度使用基本类型而非值对象

**输出格式**: 同步骤 2.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 2.5 UNTIL USER CONFIRMS**

---

## 步骤 2.5: 分层架构检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **层间依赖方向正确** - 检查层间依赖方向是否符合 DDD 分层原则
2. ✅ **无循环依赖** - 检查是否存在循环依赖
3. ✅ **接口在高层定义** - 检查接口是否在高层定义
4. ✅ **依赖注入正确使用** - 检查依赖注入是否正确使用

**输出格式**: 同步骤 2.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 2.6 UNTIL USER CONFIRMS**

---

## 步骤 2.6: 架构设计审查总结

**你必须输出以下内容，然后停止**:

**输出格式**: 同代码合规性审查总结，更新为架构设计审查的总结

**🛑 STOP HERE - DO NOT OUTPUT STEP 3 UNTIL USER CONFIRMS**

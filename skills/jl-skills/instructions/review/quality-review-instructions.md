# 代码质量审查指令 (Quality Review Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行代码审查的**步骤 4: 代码质量审查**。

> [!IMPORTANT]
> **目标**: 检查代码质量，包括复杂度、重复率、测试覆盖等。
> **测试方法命名规范**: 参考 `jl-skills/specs/Java编码规范.md` - 方法名全英文下划线命名，中文意图使用 `@DisplayName("")` 注解。

---

## 步骤 4.1: 单元测试检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **核心逻辑有测试覆盖** - 检查核心业务逻辑是否有测试覆盖
2. ✅ **测试命名规范** - 检查测试方法命名是否符合规范：
    - **方法名**: 全英文，下划线命名，格式：`test_{methodName}_{condition}_{expectedResult}`
    - **中文意图**: 使用 `@DisplayName("中文描述")` 注解
    - **TDD 阶段标识（强制）**: 在 TDD 环节，`@DisplayName` 开头必须加上 emoji：
        - 🔴 红灯阶段（Red）: `@DisplayName("🔴 正常流程：...")` - 测试应该失败
        - 🟢 绿灯阶段（Green）: `@DisplayName("🟢 正常流程：...")` - 测试应该通过
    - **示例**:
        - 🔴 Red: `test_createOrder_validInput_shouldReturnSuccess()` + `@DisplayName("🔴 正常流程：有效输入应返回成功")`
        - 🟢 Green: `test_createOrder_validInput_shouldReturnSuccess()` + `@DisplayName("🟢 正常流程：有效输入应返回成功")`
3. ✅ **测试独立可重复** - 检查测试是否独立，不依赖执行顺序
4. ✅ **Mock 使用合理** - 检查 Mock 使用是否合理，不过度 Mock

**输出格式**: 同代码合规性审查，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 4.2 UNTIL USER CONFIRMS**

---

## 步骤 4.2: 代码复杂度检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **方法长度合理（< 50 行）** - 检查方法长度是否超过 50 行
2. ✅ **圈复杂度合理（< 10）** - 检查圈复杂度是否超过 10
3. ✅ **类职责单一** - 检查类是否遵循单一职责原则
4. ✅ **参数数量合理（< 5）** - 检查方法参数数量是否超过 5 个

**输出格式**: 同步骤 4.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 4.3 UNTIL USER CONFIRMS**

---

## 步骤 4.3: 代码重复检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **无明显重复代码** - 检查是否存在重复代码
2. ✅ **公共逻辑已抽取** - 检查公共逻辑是否已抽取为公共方法
3. ✅ **工具类合理复用** - 检查是否合理使用工具类

**输出格式**: 同步骤 4.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 4.4 UNTIL USER CONFIRMS**

---

## 步骤 4.4: 性能考量检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **无明显性能隐患** - 检查是否存在明显的性能问题（如 N+1 查询）
2. ✅ **循环内无重复计算** - 检查循环内是否有重复计算
3. ✅ **资源正确关闭** - 检查资源（文件、连接等）是否正确关闭
4. ✅ **批量操作优化** - 检查批量操作是否优化（如批量插入而非循环插入）

**输出格式**: 同步骤 4.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 4.5 UNTIL USER CONFIRMS**

---

## 步骤 4.5: 代码质量审查总结

**你必须输出以下内容，然后停止**:

**输出格式**: 同代码合规性审查总结，更新为代码质量审查的总结

**🛑 STOP HERE - DO NOT OUTPUT STEP 5 UNTIL USER CONFIRMS**

# 代码合规性审查指令 (Code Compliance Review Instructions)

## ⚠️ 执行规则 (EXECUTION RULES)

```
🛑 CRITICAL: 
- 每个步骤输出后 MUST STOP
- 等待用户回复后才能继续
- 一次回复只输出一个步骤的内容
- 违反此规则将导致流程失败
```

此文档指导 Agent 执行代码审查的**步骤 1: 代码合规性审查**。

> [!IMPORTANT]
> **目标**: 检查代码是否符合 Java 编码规范。
> **参考**: `jl-skills/specs/Java编码规范.md`（如果存在）

---

## 步骤 1.1: Java 命名规范检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **类名使用 UpperCamelCase** - 检查所有类名是否符合规范
2. ✅ **方法名使用 lowerCamelCase** - 检查所有方法名是否符合规范
3. ✅ **常量名使用 UPPER_SNAKE_CASE** - 检查所有常量名是否符合规范
4. ✅ **包名全小写** - 检查包名是否符合规范
5. ✅ **变量名语义明确，避免单字符** - 检查变量命名是否清晰
6. ✅ **布尔变量使用 is/has/can 前缀** - 检查布尔变量命名是否符合规范

**输出格式**:

````markdown
## 步骤 1.1: Java 命名规范检查

📊 **进度**: [1.1/4] 代码合规性审查
[████░░░░░░░░░░░░░░░░] 5%

### Java 命名规范检查结果

| 检查项 | 状态 | 问题数量 | 详情 |
|--------|------|---------|------|
| 类名 UpperCamelCase | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |
| 方法名 lowerCamelCase | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |
| 常量名 UPPER_SNAKE_CASE | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |
| 包名全小写 | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |
| 变量名语义明确 | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |
| 布尔变量前缀 | ✅ 通过 / ⚠️ 发现问题 | X 个 | [具体问题列表] |

### 发现的问题

| 级别 | 位置 | 问题描述 | 建议 |
|------|------|----------|------|
| 🟠 Major | Line 15, `OrderService.java` | 类名 `orderService` 应为 `OrderService` | 改为 UpperCamelCase |
| 🟡 Minor | Line 32, `User.java` | 变量名 `u` 语义不明确 | 改为 `user` 或更具描述性的名称 |

**🛑 STOP HERE - DO NOT OUTPUT STEP 1.2 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤1.2的内容。
````

---

## 步骤 1.2: 异常处理规范检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **无空 catch 块（No Swallow Exception）** - 检查是否有空 catch 块吞掉异常
2. ✅ **异常信息包含上下文** - 检查异常信息是否包含足够的上下文信息
3. ✅ **正确使用 checked/unchecked 异常** - 检查异常类型使用是否合理
4. ✅ **finally 块正确释放资源** - 检查资源是否正确释放
5. ✅ **异常链正确传递** - 检查异常链是否正确传递

**输出格式**: 同步骤 1.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 1.3 UNTIL USER CONFIRMS**

---

## 步骤 1.3: 日志规范检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **使用参数化日志（避免字符串拼接）** - 检查日志是否使用参数化方式
2. ✅ **日志级别使用正确** - 检查日志级别是否合理（DEBUG/INFO/WARN/ERROR）
3. ✅ **敏感信息不出现在日志中** - 检查日志中是否包含密码、token 等敏感信息
4. ✅ **异常日志包含堆栈信息** - 检查异常日志是否包含完整的堆栈信息

**输出格式**: 同步骤 1.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 1.4 UNTIL USER CONFIRMS**

---

## 步骤 1.4: 注释规范检查

**你必须输出以下内容，然后停止**:

**检查项（必须逐项检查）**:
1. ✅ **类级别有 JavaDoc 注释** - 检查所有公共类是否有 JavaDoc 注释
2. ✅ **公共方法有注释说明** - 检查所有公共方法是否有注释
3. ✅ **复杂逻辑有行内注释** - 检查复杂逻辑是否有注释说明
4. ✅ **无过时或误导性注释** - 检查注释是否与代码一致
5. ✅ **TODO/FIXME 有跟踪** - 检查 TODO/FIXME 是否有跟踪信息

**输出格式**: 同步骤 1.1，更新进度和检查项

**🛑 STOP HERE - DO NOT OUTPUT STEP 1.5 UNTIL USER CONFIRMS**

---

## 步骤 1.5: 代码合规性审查总结

**你必须输出以下内容，然后停止**:

**输出格式**:

````markdown
## 步骤 1: 代码合规性审查完成

📊 **进度**: [1/4] 代码合规性审查
[████████████████████] 100%

### 审查总结

| 检查维度 | 通过项 | 问题项 | 得分 |
|---------|--------|--------|------|
| Java 命名规范 | X/6 | X | XX/100 |
| 异常处理规范 | X/5 | X | XX/100 |
| 日志规范 | X/4 | X | XX/100 |
| 注释规范 | X/5 | X | XX/100 |
| **总计** | X/20 | X | **XX/100** |

### 问题统计

- 🔴 Critical: X 个
- 🟠 Major: X 个
- 🟡 Minor: X 个
- 🔵 Info: X 个

### 主要问题列表

| 级别 | 位置 | 问题描述 | 建议 |
|------|------|----------|------|
| [按严重程度排序的问题列表] |

---

📋 **确认检查点**

合规性审查完成，发现 X 个问题。

- 回复 **确认** → 进入架构审查
- 回复 **详细 [行号]** → 我将展开说明
- 回复 **跳过** → 跳过此维度

**请确认：** 是否继续下一维度审查？
````

**🛑 STOP HERE - DO NOT OUTPUT STEP 2 UNTIL USER CONFIRMS**

⚠️ **重要**: 用户未回复"确认"前，禁止执行任何后续步骤，禁止输出步骤2的内容。
